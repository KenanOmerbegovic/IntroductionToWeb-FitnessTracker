<section id="admin-panel">
  <div class="container">
    <div class="admin-container">
      <div class="card">
        <h2 class="text-warning">Admin Panel</h2>
        
        <div class="alert alert-warning mb-3">
          <i class="fas fa-exclamation-triangle me-2"></i>
          <strong>Admin Access Only:</strong> This area contains administrative controls.
        </div>
        
        <!-- Admin Navigation Tabs -->
        <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="users-tab" data-bs-toggle="tab" data-bs-target="#users-panel" type="button">
              <i class="fas fa-users me-1"></i> Users
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="exercises-tab" data-bs-toggle="tab" data-bs-target="#exercises-panel" type="button">
              <i class="fas fa-dumbbell me-1"></i> Exercises
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="categories-tab" data-bs-toggle="tab" data-bs-target="#categories-panel" type="button">
              <i class="fas fa-tags me-1"></i> Categories
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics-panel" type="button">
              <i class="fas fa-chart-bar me-1"></i> Analytics
            </button>
          </li>
        </ul>
        
        <!-- Tab Content -->
        <div class="tab-content" id="adminTabContent">
          
          <!-- Users Panel -->
          <div class="tab-pane fade show active" id="users-panel" role="tabpanel">
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">User Management</h4>
                <button class="btn btn-sm btn-primary" onclick="showAddUserModal()">
                  <i class="fas fa-plus me-1"></i> Add User
                </button>
              </div>
              <div class="card-body">
                <table id="users-table" class="table table-striped" style="width:100%">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Role</th>
                      <th>Joined</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Users will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          
          <!-- Exercises Panel -->
          <div class="tab-pane fade" id="exercises-panel" role="tabpanel">
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">Exercise Management</h4>
                <button class="btn btn-sm btn-primary" onclick="showAddExerciseModal()">
                  <i class="fas fa-plus me-1"></i> Add Exercise
                </button>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table id="exercises-table" class="table table-striped" style="width:100%">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Muscle Group</th>
                        <th>Category</th>
                        <th>Created</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- Exercises will be loaded here -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Categories Panel -->
          <div class="tab-pane fade" id="categories-panel" role="tabpanel">
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">Category Management</h4>
                <button class="btn btn-sm btn-primary" onclick="showAddCategoryModal()">
                  <i class="fas fa-plus me-1"></i> Add Category
                </button>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table id="categories-table" class="table table-striped" style="width:100%">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Category Name</th>
                        <th>Description</th>
                        <th>Exercise Count</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- Categories will be loaded here -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Analytics Panel -->
          <div class="tab-pane fade" id="analytics-panel" role="tabpanel">
            <div class="card">
              <div class="card-header">
                <h4 class="mb-0">System Analytics</h4>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-3 col-6 mb-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h5 class="card-title">Total Users</h5>
                        <div class="display-4" id="total-users">0</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 col-6 mb-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h5 class="card-title">Total Workouts</h5>
                        <div class="display-4" id="admin-total-workouts">0</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 col-6 mb-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h5 class="card-title">Active Today</h5>
                        <div class="display-4" id="active-today">0</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 col-6 mb-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h5 class="card-title">Avg/User</h5>
                        <div class="display-4" id="avg-workouts-user">0</div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="card mt-3">
                  <div class="card-header">
                    <h5 class="mb-0">Recent Activity</h5>
                  </div>
                  <div class="card-body">
                    <div id="recent-activity">
                      <div class="text-center p-3">
                        <div class="spinner-border spinner-border-sm" role="status">
                          <span class="visually-hidden">Loading...</span>
                        </div>
                        <span class="ms-2">Loading activity...</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Add User Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addUserModalLabel">Add New User</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="add-user-form">
          <div class="form-group">
            <label class="form-label">Full Name *</label>
            <input type="text" class="form-control" name="full_name" required>
          </div>
          <div class="form-group">
            <label class="form-label">Email *</label>
            <input type="email" class="form-control" name="email" required>
          </div>
          <div class="form-group">
            <label class="form-label">Password *</label>
            <input type="password" class="form-control" name="password" minlength="8" required>
          </div>
          <div class="form-group">
            <label class="form-label">Role *</label>
            <select class="form-select" name="role" required>
              <option value="user">User</option>
              <option value="admin">Admin</option>
              <option value="trainer">Trainer</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="addUser()">Add User</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Exercise Modal -->
<div class="modal fade" id="addExerciseModal" tabindex="-1" aria-labelledby="addExerciseModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addExerciseModalLabel">Add New Exercise</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="add-exercise-form">
          <div class="form-group">
            <label class="form-label">Exercise Name *</label>
            <input type="text" class="form-control" name="exercise_name" required>
          </div>
          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-control" name="description" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Muscle Group *</label>
            <select class="form-select" name="muscle_group" required>
              <option value="">Select muscle group</option>
              <option value="chest">Chest</option>
              <option value="legs">Legs</option>
              <option value="back">Back</option>
              <option value="shoulders">Shoulders</option>
              <option value="arms">Arms</option>
              <option value="core">Core</option>
              <option value="cardio">Cardio</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Category</label>
            <select class="form-select" name="category_id">
              <option value="">Select category</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="addExercise()">Add Exercise</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Category Modal -->
<div class="modal fade" id="addCategoryModal" tabindex="-1" aria-labelledby="addCategoryModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addCategoryModalLabel">Add New Category</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="add-category-form">
          <div class="form-group">
            <label class="form-label">Category Name *</label>
            <input type="text" class="form-control" name="category_name" required>
          </div>
          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-control" name="description" rows="3"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="addCategory()">Add Category</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteConfirmModalLabel">Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="delete-confirm-message">
        Are you sure you want to delete this item?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirm-delete-item">Delete</button>
      </div>
    </div>
  </div>
</div>

<script>
let deleteCallback = null;
let deleteId = null;
let deleteType = null;

function initAdminPanel() {
  // Check if user is admin
  const user = UserService.getCurrentUser();
  if (!user || user.role !== Constants.ADMIN_ROLE) {
    Utils.showToast('Access denied. Admin only.', 'error');
    window.location.hash = 'dashboard';
    return;
  }
  
  loadAdminData();
  

  document.getElementById('confirm-delete-item').addEventListener('click', executeDelete);
}

function loadAdminData() {

  loadUsers();
  loadExercises();
  loadCategories();
  loadAnalytics();
}

function loadUsers() {

  const sampleUsers = [
    { user_id: 1, full_name: 'John Doe', email: 'john@example.com', role: 'user', created_at: '2024-01-15', active: true },
    { user_id: 2, full_name: 'Jane Smith', email: 'jane@example.com', role: 'admin', created_at: '2024-01-10', active: true },
    { user_id: 3, full_name: 'Bob Johnson', email: 'bob@example.com', role: 'user', created_at: '2024-01-05', active: false },
    { user_id: 4, full_name: 'Alice Williams', email: 'alice@example.com', role: 'trainer', created_at: '2024-01-01', active: true }
  ];
  
  if ($.fn.DataTable.isDataTable('#users-table')) {
    $('#users-table').DataTable().destroy();
  }
  
  $('#users-table').DataTable({
    data: sampleUsers,
    columns: [
      { data: 'user_id' },
      { data: 'full_name' },
      { data: 'email' },
      { 
        data: 'role',
        render: function(data) {
          const roles = {
            user: '<span class="badge bg-secondary">User</span>',
            admin: '<span class="badge bg-danger">Admin</span>',
            trainer: '<span class="badge bg-warning">Trainer</span>'
          };
          return roles[data] || data;
        }
      },
      { 
        data: 'created_at',
        render: function(data) {
          return new Date(data).toLocaleDateString();
        }
      },
      { 
        data: 'active',
        render: function(data) {
          return data 
            ? '<span class="badge bg-success">Active</span>' 
            : '<span class="badge bg-secondary">Inactive</span>';
        }
      },
      { 
        data: 'user_id',
        render: function(data) {
          return `
            <div class="btn-group btn-group-sm">
              <button class="btn btn-primary" onclick="editUser(${data})">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-danger" onclick="confirmDelete('user', ${data}, 'user')">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          `;
        }
      }
    ]
  });
}

function loadExercises() {
  ExerciseService.getAllExercises(function(exercises) {
    if ($.fn.DataTable.isDataTable('#exercises-table')) {
      $('#exercises-table').DataTable().destroy();
    }
    
    $('#exercises-table').DataTable({
      data: exercises,
      columns: [
        { data: 'exercise_id' },
        { data: 'exercise_name' },
        { data: 'muscle_group' },
        { data: 'category_name' },
        { 
          data: 'created_at',
          render: function(data) {
            return data ? new Date(data).toLocaleDateString() : 'â€”';
          }
        },
        { 
          data: 'exercise_id',
          render: function(data) {
            return `
              <div class="btn-group btn-group-sm">
                <button class="btn btn-primary" onclick="editExercise(${data})">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-danger" onclick="confirmDelete('exercise', ${data}, 'exercise')">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            `;
          }
        }
      ]
    });
  });
}

function loadCategories() {
  // In a real implementation, fetch categories via API
  const sampleCategories = [
    { category_id: 1, category_name: 'Strength Training', description: 'Exercises focused on building strength', exercise_count: 15 },
    { category_id: 2, category_name: 'Cardio', description: 'Cardiovascular exercises', exercise_count: 8 },
    { category_id: 3, category_name: 'Flexibility', description: 'Stretching and mobility exercises', exercise_count: 5 }
  ];
  
  if ($.fn.DataTable.isDataTable('#categories-table')) {
    $('#categories-table').DataTable().destroy();
  }
  
  $('#categories-table').DataTable({
    data: sampleCategories,
    columns: [
      { data: 'category_id' },
      { data: 'category_name' },
      { data: 'description' },
      { data: 'exercise_count' },
      { 
        data: 'category_id',
        render: function(data) {
          return `
            <div class="btn-group btn-group-sm">
              <button class="btn btn-primary" onclick="editCategory(${data})">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-danger" onclick="confirmDelete('category', ${data}, 'category')">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          `;
        }
      }
    ]
  });
}

function loadAnalytics() {
 
  document.getElementById('total-users').textContent = '42';
  document.getElementById('admin-total-workouts').textContent = '156';
  document.getElementById('active-today').textContent = '8';
  document.getElementById('avg-workouts-user').textContent = '3.7';
  

  const activityContainer = document.getElementById('recent-activity');
  const activities = [
    { user: 'John Doe', action: 'logged a chest workout', time: '2 hours ago' },
    { user: 'Jane Smith', action: 'updated profile', time: '4 hours ago' },
    { user: 'Bob Johnson', action: 'set a new personal record', time: '1 day ago' },
    { user: 'Alice Williams', action: 'created a custom workout', time: '2 days ago' },
    { user: 'Mike Brown', action: 'joined the platform', time: '3 days ago' }
  ];
  
  let activityHtml = '';
  activities.forEach(activity => {
    activityHtml += `
      <div class="activity-item d-flex align-items-center mb-2 p-2 border-bottom">
        <div class="flex-grow-1">
          <strong>${activity.user}</strong> ${activity.action}
          <div class="text-muted small">${activity.time}</div>
        </div>
      </div>
    `;
  });
  
  activityContainer.innerHTML = activityHtml;
}

function showAddUserModal() {
  const modal = new bootstrap.Modal(document.getElementById('addUserModal'));
  modal.show();
}

function addUser() {
  const form = document.getElementById('add-user-form');
  const formData = new FormData(form);
  const data = Object.fromEntries(formData.entries());
  

  Utils.showToast('User added successfully', 'success');
  

  const modal = bootstrap.Modal.getInstance(document.getElementById('addUserModal'));
  modal.hide();
  form.reset();

  loadUsers();
}

function editUser(userId) {
  Utils.showToast(`Edit user ${userId} - Feature coming soon`, 'info');
}

function showAddExerciseModal() {

  loadCategoriesForExerciseModal();
  
  const modal = new bootstrap.Modal(document.getElementById('addExerciseModal'));
  modal.show();
}

function loadCategoriesForExerciseModal() {
  const select = document.querySelector('#add-exercise-form select[name="category_id"]');
  select.innerHTML = '<option value="">Select category</option>';

  const categories = [
    { category_id: 1, category_name: 'Strength Training' },
    { category_id: 2, category_name: 'Cardio' },
    { category_id: 3, category_name: 'Flexibility' }
  ];
  
  categories.forEach(category => {
    const option = document.createElement('option');
    option.value = category.category_id;
    option.textContent = category.category_name;
    select.appendChild(option);
  });
}

function addExercise() {
  const form = document.getElementById('add-exercise-form');
  const formData = new FormData(form);
  const data = Object.fromEntries(formData.entries());
  

  Utils.showToast('Exercise added successfully', 'success');

  const modal = bootstrap.Modal.getInstance(document.getElementById('addExerciseModal'));
  modal.hide();
  form.reset();
  

  loadExercises();
}

function editExercise(exerciseId) {
  Utils.showToast(`Edit exercise ${exerciseId} - Feature coming soon`, 'info');
}

function showAddCategoryModal() {
  const modal = new bootstrap.Modal(document.getElementById('addCategoryModal'));
  modal.show();
}

function addCategory() {
  const form = document.getElementById('add-category-form');
  const formData = new FormData(form);
  const data = Object.fromEntries(formData.entries());
  

  Utils.showToast('Category added successfully', 'success');
  

  const modal = bootstrap.Modal.getInstance(document.getElementById('addCategoryModal'));
  modal.hide();
  form.reset();
  

  loadCategories();
}

function editCategory(categoryId) {
  Utils.showToast(`Edit category ${categoryId} - Feature coming soon`, 'info');
}

function confirmDelete(type, id, itemName) {
  deleteType = type;
  deleteId = id;
  
  const message = document.getElementById('delete-confirm-message');
  message.textContent = `Are you sure you want to delete this ${itemName}? This action cannot be undone.`;
  
  const modal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
  modal.show();
}

function executeDelete() {
  if (!deleteType || !deleteId) return;
  
  Utils.showToast(`${deleteType.charAt(0).toUpperCase() + deleteType.slice(1)} deleted successfully`, 'success');
  
  const modal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal'));
  modal.hide();
  
  switch (deleteType) {
    case 'user':
      loadUsers();
      break;
    case 'exercise':
      loadExercises();
      break;
    case 'category':
      loadCategories();
      break;
  }
  
  // Reset delete variables
  deleteType = null;
  deleteId = null;
}

// Initialize admin panel
initAdminPanel();
</script>